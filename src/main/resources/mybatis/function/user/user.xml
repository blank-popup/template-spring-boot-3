<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.template.function.user.MapperUser">
    <select id="getUser" resultType="com.example.template.function.user.AhaUser$Gotten" parameterType="com.example.template.function.user.AhaUser$Getting">
        SELECT
            id,
            username,
            password,
            email,
            phone,
            created_at,
            updated_at
        FROM aha_user
        WHERE username = #{username}
    </select>

    <insert id="createUser" parameterType="com.example.template.function.user.AhaUser$Creating">
        INSERT INTO aha_user (
            username,
            password,
            email,
            phone
        )
        VALUES (
            #{username},
            #{password},
            #{email},
            #{phone}
        )
    </insert>

    <update id="putUser" parameterType="com.example.template.function.user.AhaUser$Putting">
        INSERT INTO aha_user (
            username,
            password,
            email,
            phone,
            updated_at
        ) VALUES (
            #{username},
            #{password},
            #{email},
            #{phone},
            NOW()
        )
        ON DUPLICATE KEY UPDATE
            password = #{password},
            email = #{email},
            phone = #{phone},
            updated_at = NOW()
    </update>

    <update id="patchUser" parameterType="com.example.template.function.user.AhaUser$Patching">
        UPDATE aha_user
        SET
            password = IFNULL(#{password}, password),
            email = IFNULL(#{email}, email),
            phone = IFNULL(#{phone}, phone),
            updated_at = NOW()
        WHERE username = #{username}
    </update>

    <delete id="removeUser" parameterType="com.example.template.function.user.AhaUser$Removing">
        DELETE
        FROM aha_user
        WHERE username = #{username}
    </delete>

    <select id="getFileDownload" resultType="com.example.template.function.user.AhaUserImage$Downloaded" parameterType="com.example.template.function.user.AhaUserImage$Downloading">
        SELECT
            filename_server,
            filename_client
        FROM aha_user_image
        WHERE filename_server = #{filenameServer}
    </select>

    <insert id="createUserImage" parameterType="com.example.template.function.user.AhaUserImage$Uploading">
        INSERT aha_user_image (
            id_user,
            description,
            filename_server,
            filename_client
        )
        VALUES (
            #{id},
            #{description},
            #{filenameServer},
            #{filenameClient}
        )
    </insert>
</mapper>
